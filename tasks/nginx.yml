---
- name: Add nginx ppa
  apt_repository: repo='ppa:nginx/stable'

- name: Install nginx
  apt: name=nginx

- name: Create ssl directory
  file: dest=/etc/nginx/ssl state=directory

- name: Create self-signed SSL cert
  command: 'openssl req -new -nodes -x509 -subj "/C=US/ST=Oregon/L=Portland/O=IT/CN=*.{{domain}}" -days 3650 -keyout /etc/nginx/ssl/server.key -out /etc/nginx/ssl/server.crt -extensions v3_ca'
  args:
    creates: /etc/nginx/ssl/server.crt
  notify: restart nginx

- name: Allow http(s) traffic through firewall
  ufw: rule=allow port={{item}}
  with_items:
    - 80
    - 443